<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Slorui">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/plugin/bganimation/bg.css">

  

  <link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" rel="stylesheet" type="text/css">
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <div class="widget-wrap mobile-header">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/20210321171549.jpg">
    <h2 class="author">Slorui</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>50</strong><br>文章</div></a>
      <a href="/categories"><div><strong>8</strong><br>分类</div></a>
      <a href="/tags"><div><strong>12</strong><br>标签</div></a>
    </div>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

        <section id="main">
  
    <article id="post-redis/redis对象类型和编码" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/02/redis/redis%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E5%92%8C%E7%BC%96%E7%A0%81/" class="article-date">
  <time class="post-time" datetime="2021-04-02T09:09:43.442Z" itemprop="datePublished">
    <span class="post-month">4月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/02/redis/redis%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E5%92%8C%E7%BC%96%E7%A0%81/">redis对象类型和编码</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/redis/">redis</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="redis对象类型和编码"><a class="markdownIt-Anchor" href="#redis对象类型和编码"></a> redis对象类型和编码</h3>
<p>redis使用对象标识数据库的key和value</p>
<p>redis每个对象都有一个redisObject结构标识</p>
<ul>
<li>type：类型，标识用户外部使用的类型，string，set、list、hash、zset等</li>
<li>encoding：编码，底层类型，具体的数据结构（sds、long、hash table、zipmap、ziplist、intset、skiplist等）</li>
<li>ptr：指针</li>
<li>lru：最后一次访问时间</li>
<li>refcount：引用计数（只有整数可以共用），当引用减为0，会释放空间</li>
</ul>
<p><code>OBJECT ENCODING msg</code> 查看msg底层的数据结构</p>
<h4 id="字符串对象"><a class="markdownIt-Anchor" href="#字符串对象"></a> 字符串对象</h4>
<p>字符串对象可以存string，long，long long ，double等</p>
<p>编码可以是int、raw（sds）或者embstr</p>
<p>createRawObject：创建raw对象</p>
<ol>
<li>分配Object内存，设置类型、编码、lru等</li>
<li>设置共享，最大的int值</li>
<li>创建RawString对象</li>
</ol>
<p>createEmbedStringObject：创建embstr对象</p>
<ol>
<li>直接分配整块内存</li>
<li>设置类型、编码、lru等</li>
<li>拷贝字符串</li>
</ol>
<p>当字符串对象保存的字符串小于39字节时（因为内存函数限定64？），使用embstr编码保存</p>
<p>mbstr相对于sds来说，是一种优化编码方式，raw编码会调用两次内存分配创建object和sds，embstr一次内存分配一块连续的空间存储</p>
<p>好处：</p>
<ol>
<li>内存分配减少为1次</li>
<li>释放只需要调用一次释放内存函数</li>
<li>因为数据都在一块连续内存，可以更换的利用缓存优势（内存连续读取）</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/02/redis/redis%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E5%92%8C%E7%BC%96%E7%A0%81/" data-id="ckn04d4fp0005twvxc9fcfhtk" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-redis/redis跳表" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/02/redis/redis%E8%B7%B3%E8%A1%A8/" class="article-date">
  <time class="post-time" datetime="2021-04-02T08:43:19.477Z" itemprop="datePublished">
    <span class="post-month">4月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/02/redis/redis%E8%B7%B3%E8%A1%A8/">redis跳表</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/redis/">redis</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="redis跳表"><a class="markdownIt-Anchor" href="#redis跳表"></a> redis跳表</h3>
<h4 id="结构"><a class="markdownIt-Anchor" href="#结构"></a> 结构</h4>
<p>zskiplist：跳表</p>
<ul>
<li>header：头指针</li>
<li>tail：尾指针</li>
<li>length：长度</li>
<li>level：当前最高的层</li>
</ul>
<p>zskiplistNode：跳表节点</p>
<ul>
<li>sds：字符串值</li>
<li>score：分值，排序zskiplistNode，可以相同</li>
<li>backword：zskiplistNode指针</li>
<li>zkiplistLevel[]：level数组，层高随机
<ul>
<li>forward：zskiplistNode指针，指向下一个同层</li>
<li>span：到一个节点中间跳过了几个节点，没跳就是1</li>
</ul>
</li>
</ul>
<h4 id="逻辑"><a class="markdownIt-Anchor" href="#逻辑"></a> 逻辑</h4>
<p>zslCreate：创建zskipList</p>
<ol>
<li>初始化空间，level=1，初始化头节点，level是32</li>
</ol>
<p>zslRandmomLevel：随机产生层数，最大是32层</p>
<p>zslInsert：插入节点，传入string和分数</p>
<ol>
<li>从头节点的最高处开始查找，每层的rank表示上一层跳表的个数</li>
<li>在每一次一直找到大于score或者score和string都相同的节点时退出</li>
<li>创建新的节点，如果高度高于当前跳表高度，跳表头进行链接</li>
<li>插入节点，修改跳表并计算跳表距离</li>
<li>设置后退指针</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/02/redis/redis%E8%B7%B3%E8%A1%A8/" data-id="ckn04d4g4000atwvxg4eo75dz" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-redis/redis字典" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/02/redis/redis%E5%AD%97%E5%85%B8/" class="article-date">
  <time class="post-time" datetime="2021-04-02T07:40:38.939Z" itemprop="datePublished">
    <span class="post-month">4月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/02/redis/redis%E5%AD%97%E5%85%B8/">redis字典</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/redis/">redis</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="redis字典"><a class="markdownIt-Anchor" href="#redis字典"></a> redis字典</h3>
<h4 id="结构"><a class="markdownIt-Anchor" href="#结构"></a> 结构</h4>
<p>字典是数组里存放了一个ditEntry，每个entry包含key和value对象类型，value链表的指针</p>
<p>字典包含了：</p>
<ul>
<li>字典类型</li>
<li>两个hash表，为了rehash，扩容时使用，一般放在h0</li>
<li>rehashidx，rehash标识，是否正在rehash，-1不能rehash     当数量/容量 &gt;5 强制rehash</li>
</ul>
<p>hash表：</p>
<ul>
<li>entry：指向指针集合，可以理解为数组</li>
<li>hash表大小</li>
<li>计算掩码（size-1）等同于java</li>
<li>use，已使用大小</li>
</ul>
<p>迭代器：</p>
<ul>
<li>d：指向的字典</li>
<li>index：索引的位置</li>
<li>safe：标识迭代器是否安全，某些操作会被禁止</li>
<li>entry指针：当前和下一个两个指针</li>
<li>fingerprint：hash值，判断hash表是否修改</li>
</ul>
<h4 id="逻辑"><a class="markdownIt-Anchor" href="#逻辑"></a> 逻辑</h4>
<p>dictResize：把hashTable变成最小的包含所有元素的表，缩小hashTable</p>
<ol>
<li>判断是否可以reHash或是否正在reHash</li>
<li>当使用/总bucket小于1时，进行缩小，最小是4</li>
<li>计算新的hashTable的大小</li>
<li>进行扩张
<ol>
<li>初始化新的hashTable</li>
<li>如果已经有0号hashTable，就把新的hashTable付给1号，然后标记可以rehash，从0到1开始hash</li>
</ol>
</li>
</ol>
<p>rehash：将0号复制到1号。</p>
<p>定时任务，每个确定的ms内进行rehash，搬运100个，server启动时注册到了时间函数中</p>
<ol>
<li>循环所有bucket</li>
<li>对每个链表的每个节点进行rehash并放入h1</li>
<li>修改h0和h1的used数值</li>
<li>h0和h1交换</li>
</ol>
<p>dictAddRaw：添加新的键值</p>
<ol>
<li>查找是否相同的key，如果有返回-1</li>
<li>如果正在rehash，就确定要添加到h1，否则h0</li>
<li>分配entry空间，头插法插入entry</li>
<li>将entry填入key和val，如果已存在key，直接覆盖</li>
</ol>
<p>dictGenericDelete：删除</p>
<ol>
<li>对两个表进行删除</li>
<li>对每个表循环，找到key相同的entry，并删除节点</li>
<li>修改use值即可</li>
</ol>
<p>find和delete相同</p>
<p>dicNext：迭代器</p>
<ol>
<li>初次迭代时初始化迭代器类型（安全还是不安全）</li>
<li>如果迭代到表后，判断是否rehash，如果是，取h1表迭代</li>
<li>如果entry为null，取下一个桶取，否则取链表的下一个entry</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/02/redis/redis%E5%AD%97%E5%85%B8/" data-id="ckn04d4fo0004twvxdvudbotp" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-redis/redis链表" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/02/redis/redis%E9%93%BE%E8%A1%A8/" class="article-date">
  <time class="post-time" datetime="2021-04-02T07:33:48.974Z" itemprop="datePublished">
    <span class="post-month">4月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/02/redis/redis%E9%93%BE%E8%A1%A8/">redis链表</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/redis/">redis</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="redis链表"><a class="markdownIt-Anchor" href="#redis链表"></a> redis链表</h3>
<p>包含链表和迭代器，是一个双向队列</p>
<p>迭代器包含内存指针，0代表正方向迭代，从头开始，1代表反方向迭代，从尾开始</p>
<p>可以传入的自定义dup、match、free等方法进行链表的复制、匹配、释放等</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/02/redis/redis%E9%93%BE%E8%A1%A8/" data-id="ckn04d4gb000ptwvx66fa3su9" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-redis/redis简单动态字符串" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/02/redis/redis%E7%AE%80%E5%8D%95%E5%8A%A8%E6%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2/" class="article-date">
  <time class="post-time" datetime="2021-04-02T07:10:18.924Z" itemprop="datePublished">
    <span class="post-month">4月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/02/redis/redis%E7%AE%80%E5%8D%95%E5%8A%A8%E6%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2/">redis简单动态字符串</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/redis/">redis</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="redis简单动态字符串"><a class="markdownIt-Anchor" href="#redis简单动态字符串"></a> redis简单动态字符串</h3>
<p>redis的SDS分为连部分，头+数据字段</p>
<p>SDS有多种头部，不同的长度分配的头部不同。</p>
<p>头部包含</p>
<ul>
<li>len：以使用的长度</li>
<li>alloc：头部+后面分配的+\0的结束符长度（实际分配的大小）</li>
<li>flags：头部的类型</li>
<li>buf[]：柔性数组，标识后面是一个char指针，不占大小</li>
</ul>
<h4 id="初始化"><a class="markdownIt-Anchor" href="#初始化"></a> 初始化</h4>
<p>初始化时，传入字符串，会计算字符串的长度，然后进行初始化</p>
<p>初始化：</p>
<ol>
<li>计算类型</li>
<li>计算头长度</li>
<li>分配内存：头+字符串长度+1 (\0)</li>
<li>全部初始化为0</li>
<li>初始化头部数据</li>
<li>把字符串拷贝到SDS的字符串位置</li>
</ol>
<h4 id="字符串修改"><a class="markdownIt-Anchor" href="#字符串修改"></a> 字符串修改</h4>
<p>结尾增加字符串：</p>
<ol>
<li>计算当前字符串长度</li>
<li>确保有足够的空余空间，不够会扩充
<ol>
<li>传入字符串和新增长度</li>
<li>如果新旧字符串长小于1M，长度扩大2倍，否则加1M</li>
<li>计算字符串类型（为了压缩空间）</li>
<li>如果头不变，从原开始重新分配空间，数据不会修改，只是增大空间；如果头变，分配新的空间，将旧字符串拷贝</li>
</ol>
</li>
<li>新字符串追加</li>
<li>设置新的长度</li>
</ol>
<p>字符串修剪：</p>
<ol>
<li>从左到右和从右到左找满足要修剪的子串</li>
<li>计算边界和剩余长度</li>
<li>剩余字符串移动到头部</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/02/redis/redis%E7%AE%80%E5%8D%95%E5%8A%A8%E6%80%81%E5%AD%97%E7%AC%A6%E4%B8%B2/" data-id="ckn04d4fq0006twvxcn121dh9" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-redis/redis发布订阅" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/02/redis/redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/" class="article-date">
  <time class="post-time" datetime="2021-04-02T06:22:50.062Z" itemprop="datePublished">
    <span class="post-month">4月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/02/redis/redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/">redis发布订阅</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/redis/">redis</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="redis发布订阅"><a class="markdownIt-Anchor" href="#redis发布订阅"></a> redis发布订阅</h3>
<p>redis发布订阅(pub/sub)是一种消息通信模式：发送者(pub)发生信息，订阅者(sub)接收消息。</p>
<p>redis客户端可以订阅任意数量的频道</p>
<p><code>subscribe channel</code>  订阅一个频道（如果没有，频道会自动创建），每次等待接收三条信息（消息，频道、内容）</p>
<p><code>publish cahnnel message</code> 向频道发送一个信息</p>
<p><code>psubcribe pattern</code> 订阅多个满足pattern的频道</p>
<p><code>unsubscribe channel</code> 取消订阅</p>
<p><code>punsubscribe pattern</code>取消满足pattern的频道</p>
<p>当订阅一个频道后，redis维护一个字典，key就是channel，值是一个链表，维护了订阅频道的客户端</p>
<p>subscribe就是将客户端添加到channel的链表</p>
<p>publish向对应的channel链表所有客户端发送消息</p>
<p>场景：</p>
<ol>
<li>实时消息系统</li>
<li>实时聊天（频道当作聊天室）</li>
<li>订阅、关注系统都可以</li>
</ol>
<p>稍微复杂的场景使用消息中间件MQ做</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/02/redis/redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85/" data-id="ckn04d4gc000rtwvx9iv40hhb" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-redis/redis事务" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/02/redis/redis%E4%BA%8B%E5%8A%A1/" class="article-date">
  <time class="post-time" datetime="2021-04-02T06:02:03.208Z" itemprop="datePublished">
    <span class="post-month">4月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/02/redis/redis%E4%BA%8B%E5%8A%A1/">redis事务</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/redis/">redis</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="redis事务"><a class="markdownIt-Anchor" href="#redis事务"></a> redis事务</h3>
<p>redis事务的本质：一直命令的集合。一个事务中所有命令被序列化，事务执行过程种，按顺序执行。</p>
<p>一次性、顺序写、排他性执行一些里列的命令</p>
<p><font color='red'> redis单条命令保存原子性，但事务不保证原子性</font></p>
<p><font color='red'>redis事务没有隔离级别的概念，命令会进入队列，只有发起执行时才执行</font></p>
<p>reids的事务：</p>
<ul>
<li>开启事务（multi）</li>
<li>命令入队（使用命令）</li>
<li>执行事务（exec）</li>
<li>取消事务(discard)</li>
</ul>
<p><font color='red'> redis事务编译时异常，事务会取消</font></p>
<p><font color='red'> redis事务运行时异常，错误命令会报错，不会影响其他命令的执行</font>（需要加锁监控）</p>
<p><code>watch key</code>对key加监视，乐观锁，当执行事务时发现key被修改，事务执行失败</p>
<p><code>unwatch</code>放弃监视</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/02/redis/redis%E4%BA%8B%E5%8A%A1/" data-id="ckn04d4bi0000twvx183ig50f" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-redis/redis五大数据类型" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/02/redis/redis%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" class="article-date">
  <time class="post-time" datetime="2021-04-02T05:29:25.357Z" itemprop="datePublished">
    <span class="post-month">4月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/02/redis/redis%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">redis五大数据类型</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/redis/">redis</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="redis五大数据类型"><a class="markdownIt-Anchor" href="#redis五大数据类型"></a> redis五大数据类型</h3>
<p>redis是一个内存数据结构存储系统，可以作为数据库、缓存和消息中间件MQ。</p>
<p>redis支持多种数据结构：字符串（String）、散列（hash）、列表（list）、集合（sets）、有序集合（sorted sets）和范围查询，bitmaps、hypeloglogs和地理空间（geospatial）索引半径查询。</p>
<p>redis内置了复制（replication），LUA脚本（lua scripting），LRU驱动事件（LRU eviction）、事务（transaction）和不同级别的持久化（persistence）</p>
<p>redis通过哨兵（Sentinel）和自动分区（Cluster）提供高可用性</p>
<h4 id="string"><a class="markdownIt-Anchor" href="#string"></a> String</h4>
<p><code>append key val</code>往key的value后面追加val，如果不存在key，相对于<code>set key</code></p>
<p><code>strlen key</code>获取key的value的字符串长度</p>
<p><code>incr key</code> key的value值加1</p>
<p><code>derc key</code>key的value值减1</p>
<p><code>incrby key size</code>key的value值加size</p>
<p><code>decrby key size</code>key的value值减size</p>
<p><code>getrange key start stop</code>截取字符串，可以得到stop位置，stop为-1表示全部字符串</p>
<p><code>setrange key start val</code>用val替换key的value从start开始的值</p>
<p><code>setex(set with expire) key second value</code>设置带过期事件的字符串</p>
<p><code>setnx(set if not exist) key value</code>如果不存在就设置，分布式锁常常使用</p>
<p><code>mset k1 v1 k2 v2 k3 v3</code>一次性设置多个 <code>mset user:1:key value user:1:key1 value1</code></p>
<p><code>mget k1 k2 k3</code>一次获取多个</p>
<p><code>msetxnx k1 v1 k2 v2</code>一次设置多个，如果不存在就设置，原子性操作，一个失败全部失败</p>
<p><code>getset key value</code>先获取再设置，不存在就返回nil，存在就获取原值，并设置为新值</p>
<p>使用场景：value是字符串，还可以是数字</p>
<ul>
<li>计数器</li>
<li>统计多单位的数量 uid:keys::value</li>
<li>粉丝数</li>
<li>对象缓存存储</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/02/redis/redis%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" data-id="ckn04d4f90001twvx0gl27ypg" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-redis/redis基础知识" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/04/02/redis/redis%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="article-date">
  <time class="post-time" datetime="2021-04-02T05:14:08.276Z" itemprop="datePublished">
    <span class="post-month">4月</span><br/>
    <span class="post-day">02</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/04/02/redis/redis%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">redis基础知识</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/redis/">redis</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="redis基础知识"><a class="markdownIt-Anchor" href="#redis基础知识"></a> redis基础知识</h4>
<ol>
<li>
<p>共16个数据库，默认使用第0个数据库，使用<code>select x</code>使用不同数据库</p>
</li>
<li>
<p><code>DBSIZE</code>查看当前数据库大小</p>
</li>
<li>
<p><code>keys *</code>查看当前数据库所有的key</p>
</li>
<li>
<p><code>flush all</code>清空全库</p>
</li>
<li>
<p><code>flush db</code>清空当前数据库</p>
</li>
<li>
<p><code>set key value</code>设置key-value</p>
</li>
<li>
<p><code>exists key</code>是否存在一个key</p>
</li>
<li>
<p><code>move key index</code>删除index数据库的key</p>
</li>
<li>
<p><code>clear</code>清空屏幕</p>
</li>
<li>
<p><code>expire key second</code>设置key的过期时间</p>
</li>
<li>
<p><code>ttl key</code>获取key的过期时间</p>
</li>
<li>
<p><code>type key</code>查看key类型</p>
</li>
<li>
<p>为什么redis使用6379作为端口号：明星MERZ九宫格拼写</p>
</li>
<li>
<p>redis是单线程的</p>
</li>
<li>
<p>redis是基于内存操作的，cpu不是redis的性能瓶颈，瓶颈是机器的内存和网络带宽，所以单线程就可以</p>
</li>
<li>
<p>redis单线程还这么快：</p>
<ol>
<li>c语言写的，10w+的QPS，完全不必k-v的memcache差</li>
<li>高性能的服务器不一定是多线程的</li>
<li>多线程不一定比单线程快，多线程会线程切换</li>
<li>redis将所有数据放在内存，所有单线程取操作就是效率最高的，对于内存系统，如果没有上下文切换效率最高。多次读写都是在一个cpu上，在内存下，就是最佳方案</li>
</ol>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/04/02/redis/redis%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" data-id="ckn04d4ga000otwvx08akgqrx" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/" rel="tag">redis</a></li></ul>

    </footer>
  </div>
  
</article>




  
    <article id="post-spring/spring注入" class="wow slideInRight article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/03/29/spring/spring%E6%B3%A8%E5%85%A5/" class="article-date">
  <time class="post-time" datetime="2021-03-29T13:26:10.615Z" itemprop="datePublished">
    <span class="post-month">3月</span><br/>
    <span class="post-day">29</span>
  </time>
</a>
   
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/03/29/spring/spring%E6%B3%A8%E5%85%A5/">spring注入</a>
    </h1>
  

        <div>
          
  <div class="article-category">
    <a class="article-category-link" href="/categories/spring/">spring</a>
  </div>

          
              

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="spring注入"><a class="markdownIt-Anchor" href="#spring注入"></a> spring注入</h3>
<h4 id="注入方式"><a class="markdownIt-Anchor" href="#注入方式"></a> 注入方式</h4>
<p>DI（Dependenct Inject）注入一共有两种主要的变体：基于<strong>setter注入</strong>和<strong>基于构造器注入</strong> ，注入都是这两种方式或这两种的变体，例如@autowired，通过Java反射，<code>field.set(val,Object)</code>实现，是一种变体。</p>
<h5 id="基于setter注入"><a class="markdownIt-Anchor" href="#基于setter注入"></a> 基于setter注入</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="comment">// B属性即使没有也可以调用setter方法</span></span><br><span class="line">    B b;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setXxx</span><span class="params">(B b)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;spring 找到符合的setter&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;和属性无关，甚至可以不要属性&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;可以直接调用，这个A里面就没有任何属性&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>手动注入</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;a&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.slorui.app.A&quot;</span> &gt;</span></span><br><span class="line">    // name 对应属性名</span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;b&quot;</span> <span class="attr">ref</span> <span class="attr">bean</span>=<span class="string">&quot;b&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;b&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;com.slorui.app.B&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>自动注入</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">		GenericBeanDefinition beanDefinitionA = (GenericBeanDefinition) beanFactory.getBeanDefinition(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">		<span class="comment">// 设置自动注入 也会调用setter</span></span><br><span class="line">        beanDefinitionA.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_BY_TYPE);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h5 id="基于构造器注入"><a class="markdownIt-Anchor" href="#基于构造器注入"></a> 基于构造器注入</h5>
<p><strong>基于构造器的注入与setter注入不同，会在创建bean时选择构造器并调用进行创建，因此即使是手动，也无法通过设置实现对类的忽略</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	B b;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">(B b)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.b = b;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>手动注入</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;a&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.slorui.app.A&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;b&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;beanThree&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;b&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.slorui.app.B&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>自动注入</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">	GenericBeanDefinition beanDefinitionA = (GenericBeanDefinition) beanFactory.getBeanDefinition(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">	<span class="comment">// 设置自动注入 也会调用setter</span></span><br><span class="line">       beanDefinitionA.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_CONSTRUCTOR);</span><br><span class="line">       <span class="comment">// 此处设置不生效，无法忽略B</span></span><br><span class="line">       beanFactory.ignoreDependencyType(B.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="注入模式"><a class="markdownIt-Anchor" href="#注入模式"></a> 注入模式</h4>
<p>注入模式和注入方式不同，注入方式是注入的手段（如何注入），注入模式是注入时的行为（通过什么注入）</p>
<ol>
<li><code>AUTOWIRE_NO</code>：不自动注入，是默认的注入模式，值为0</li>
<li><code>AUTOWIRE_BY_NAME</code>：通过Bean名字注入，值为1</li>
<li><code>AUTOWIRE_BY_TYPE</code>：通过Bean类型注入，值为2</li>
<li><code>AUTOWIRE_CONSTRUCTOR</code>：通过构造器注入，值为3</li>
<li><code>AUTOWIRE_AUTODETECT</code>：自动检测，值为4，已经被废弃。</li>
</ol>
<h5 id="设置注入模式"><a class="markdownIt-Anchor" href="#设置注入模式"></a> 设置注入模式</h5>
<ol>
<li>xml</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span></span></span><br><span class="line"><span class="tag">	   <span class="attr">default-autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span> // 这里设置全局注入模式，当前xml里的都是这种模式</span><br><span class="line">    </span><br><span class="line">    // 这里设置当前Bean的注入模式，会覆盖全局</span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;a&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.luban.app.A&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;constructor&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>java配置</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">	GenericBeanDefinition beanDefinitionA = (GenericBeanDefinition) beanFactory.getBeanDefinition(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">	<span class="comment">// 设置自动注入模式</span></span><br><span class="line">       beanDefinitionA.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_CONSTRUCTOR);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="实现原理"><a class="markdownIt-Anchor" href="#实现原理"></a> 实现原理</h5>
<p>sring在<code>populateBean</code>时，会判断注入模式，然后进行对应的注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> resolvedAutowireMode = mbd.getResolvedAutowireMode();</span><br><span class="line"><span class="keyword">if</span> (resolvedAutowireMode == AUTOWIRE_BY_NAME || resolvedAutowireMode == AUTOWIRE_BY_TYPE) &#123;</span><br><span class="line">	MutablePropertyValues newPvs = <span class="keyword">new</span> MutablePropertyValues(pvs);</span><br><span class="line">	<span class="comment">// Add property values based on autowire by name if applicable.</span></span><br><span class="line">	<span class="keyword">if</span> (resolvedAutowireMode == AUTOWIRE_BY_NAME) &#123;</span><br><span class="line">		autowireByName(beanName, mbd, bw, newPvs);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// Add property values based on autowire by type if applicable.</span></span><br><span class="line">	<span class="keyword">if</span> (resolvedAutowireMode == AUTOWIRE_BY_TYPE) &#123;</span><br><span class="line">		autowireByType(beanName, mbd, bw, newPvs);</span><br><span class="line">	&#125;</span><br><span class="line">	pvs = newPvs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="autowired"><a class="markdownIt-Anchor" href="#autowired"></a> @Autowired</h4>
<p><code>@Autowired</code>使用反射进行类的注入，注入时首先通过ByType注入，如果找不到，进行ByName，都找不报错</p>
<h5 id="原理"><a class="markdownIt-Anchor" href="#原理"></a> 原理</h5>
<ol>
<li>spring容器启动时，<code>AutowiredAnnotationBeanPostProcessor</code>被注册到容器</li>
<li>扫描代码，如果带有@Autowired注解，则将依赖注入信息封装到<code>InjectionMetadata</code>中（见扫描过程）
<ol>
<li>扫描当前类中标注@Autowired的属性和方法</li>
<li>再查找父类中注@Autowired的属性和方法，依次遍历</li>
</ol>
</li>
<li>创建bean时（实例化对象和初始化），会调用各种<code>BeanPostProcessor</code>对bean初始化，<code>AutowiredAnnotationBeanPostProcesso</code>r负责将相关的依赖注入进来</li>
</ol>
<h5 id="执行时机"><a class="markdownIt-Anchor" href="#执行时机"></a> 执行时机</h5>
<ol>
<li><code>AbstractBeanFactory#doCreateBean</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用属性合并后置处理器</span></span><br><span class="line">applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>调用<code>AutowiredAnnotationBeanPostProcessor</code>的后置处理器</li>
<li>``AutowiredAnnotationBeanPostProcessor#findAutowiringMetadata`查找@Autowired元数据</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 创建自动注入元数据</span></span><br><span class="line"><span class="comment">  * 处理被<span class="doctag">@Autowired</span>标记的方法、属性，以及父类被标记的</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">	metadata = buildAutowiringMetadata(clazz);</span><br></pre></td></tr></table></figure>
<h4 id="多个候选者的解决方案"><a class="markdownIt-Anchor" href="#多个候选者的解决方案"></a> 多个候选者的解决方案</h4>
<p>当自动注入时发现多个可匹配的类时，spring会报错，解决方案如下</p>
<ol>
<li>设置默认的注入类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">		GenericBeanDefinition beanDefinitionA = (GenericBeanDefinition) beanFactory.getBeanDefinition(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">		<span class="comment">// 对于接口C的候选类，默认使用D来注入</span></span><br><span class="line">        beanFactory.registerResolvableDependency(C.class,<span class="keyword">new</span> D());</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>设置优先级，使用<code>@primary</code>注解标识要注入的类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Y</span> <span class="keyword">implements</span> <span class="title">X</span></span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>设置优先级，使用<code>@Priority(x)</code>标识类的优先级</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Priority(2)</span> <span class="comment">// 优先级从小到大</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Y</span> <span class="keyword">implements</span> <span class="title">X</span></span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/29/spring/spring%E6%B3%A8%E5%85%A5/" data-id="ckmuoxeyt0000pwvx6mok1rwf" class="article-share-link">分享</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/" rel="tag">spring</a></li></ul>

    </footer>
  </div>
  
</article>




  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">next &amp;raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <h1 class="blog-title">Blog</h1>
    <h2 class="blog-subtitle"></h2>
    <ul class="blog-link">
     
          <a href="/" title="Home">
            <li>主页</li>
          </a>
        
          <a href="/archives" title="Archives">
            <li>归档</li>
          </a>
        
          <a href="/categories" title="Categories">
            <li>分类</li>
          </a>
        
          <a href="/tags" title="Tags">
            <li>标签</li>
          </a>
        
    </ul>
  </div>
</div>

  
    <div class="widget-wrap">
  <h3 class="widget-title"></h3>
  <div class="widget">
    <img class="avatar" src="/images/20210321171549.jpg">
    <h2 class="author">Slorui</h2>
    <h3 class="description"></h3>
    <div class="count-box">
      <a href="/archives"><div><strong>50</strong><br>文章</div></a>
      <a href="/categories"><div><strong>8</strong><br>分类</div></a>
      <a href="/tags"><div><strong>12</strong><br>标签</div></a>
    </div>



    <div class="social-link">
      
        <a class="hvr-bounce-in" href="http://github.com/slorui" target="_blank" title="Github">
          Github
        </a>
      
    </div>

    <div class="friend-link">
      <h2>友情链接</h2>
      
        <a class="hvr-bounce-in" href="" target="_blank" title="ShanaMaid">
          ShanaMaid
        </a>
      
    </div>
  </div>
</div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy;2020 - 2021 Slorui<br>
      由<a href="http://hexo.io/" target="_blank">Hexo</a>强力驱动 | 
      主题-<a target="_blank" rel="noopener" href="https://github.com/ShanaMaid/hexo-theme-shana">Shana</a>
      
    </div>
    
  </div>
</footer>
    </div>
    

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="//apps.bdimg.com/libs/wow/0.1.6/wow.min.js"></script>
<script>
new WOW().init();
</script>   


  
<link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css">

  
<script src="/plugin/fancybox/jquery.fancybox.pack.js"></script>




  
<link rel="stylesheet" href="/plugin/galmenu/GalMenu.css">

  
<script src="/plugin/galmenu/GalMenu.js"></script>

  <div class="GalMenu GalDropDown">
      <div class="circle" id="gal">
        <div class="ring">
          
            <a href="/" title="" class="menuItem">首页</a>
          
            <a href="/tags" title="" class="menuItem">标签</a>
          
            <a href="/categories" title="" class="menuItem">分类</a>
          
            <a href="/archives" title="" class="menuItem">归档</a>
          
            <a href="/xxxxxxxxx" title="" class="menuItem">xxx</a>
          
            <a href="/xxxxxxx" title="" class="menuItem">xxxx</a>
          
        </div>
        
          <audio id="audio" src="#"></audio>
        
      </div> 
</div>
<div id="overlay" style="opacity: 1; cursor: pointer;"></div>
  <script type="text/javascript">var items = document.querySelectorAll('.menuItem');
    for (var i = 0,
    l = items.length; i < l; i++) {
      items[i].style.left = (50 - 35 * Math.cos( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%";
      items[i].style.top = (50 + 35 * Math.sin( - 0.5 * Math.PI - 2 * (1 / l) * i * Math.PI)).toFixed(4) + "%"
    }</script>
<script type="text/javascript">
  $(document).ready(function() {
    $('body').GalMenu({
      'menu': 'GalDropDown'
    })
  });
</script>

  <section class="hidden-xs"> 
  <ul class="cb-slideshow"> 
    <li><span>苟利</span></li> 
    <li><span>国家</span></li> 
    <li><span>生死以</span></li> 
    <li><span>岂能</span></li> 
    <li><span>祸福</span></li> 
    <li><span>趋避之</span></li> 
  </ul>
</section>

<script src="/js/script.js"></script>




  </div>
</body>
</html>